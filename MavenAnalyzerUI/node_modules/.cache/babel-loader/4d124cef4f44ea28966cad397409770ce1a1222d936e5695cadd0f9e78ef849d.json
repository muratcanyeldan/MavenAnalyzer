{"ast":null,"code":"import React,{useState,useEffect,useRef}from'react';import{useParams,useNavigate}from'react-router-dom';import{Typography,Paper,Box,Button,TextField,CircularProgress,Stepper,Step,StepLabel,Grid,Card,CardContent,Divider,Alert,Chip,IconButton,FormControlLabel,Switch}from'@mui/material';import CloudUploadIcon from'@mui/icons-material/CloudUpload';import CodeIcon from'@mui/icons-material/Code';import DescriptionIcon from'@mui/icons-material/Description';import ArrowBackIcon from'@mui/icons-material/ArrowBack';import CloseIcon from'@mui/icons-material/Close';import api from'../services/api';import{toast}from'react-hot-toast';import{jsx as _jsx,jsxs as _jsxs,Fragment as _Fragment}from\"react/jsx-runtime\";const steps=['Select Input Method','Configure Analysis','Review & Start'];const NewAnalysis=()=>{const{id:projectId}=useParams();const navigate=useNavigate();const fileInputRef=useRef(null);const[activeStep,setActiveStep]=useState(0);const[loading,setLoading]=useState(true);const[project,setProject]=useState(null);const[inputMethod,setInputMethod]=useState('file');// 'file' or 'manual'\nconst[pomFile,setPomFile]=useState(null);const[pomContent,setPomContent]=useState('');const[analysisOptions,setAnalysisOptions]=useState({checkVulnerabilities:true,checkLicenses:true,generateReport:true,includeTransitive:true,notifyOnCompletion:false});const[submitting,setSubmitting]=useState(false);const[error,setError]=useState(null);useEffect(()=>{// Actually fetch the project data from the API\nconst fetchProject=async()=>{try{const response=await api.projects.getById(projectId);setProject(response.data);}catch(error){console.error('Error fetching project:',error);setError('Failed to load project details. Please try again.');setProject({id:parseInt(projectId),name:'Unknown Project',description:'Project details could not be loaded'});}finally{setLoading(false);}};fetchProject();},[projectId]);const handleBack=()=>{setActiveStep(prevStep=>prevStep-1);};const handleNext=()=>{setActiveStep(prevStep=>prevStep+1);};const handleFileUpload=event=>{const file=event.target.files[0];if(file){setPomFile(file);// Read file content\nconst reader=new FileReader();reader.onload=e=>{setPomContent(e.target.result);};reader.readAsText(file);}};const handleFileClick=()=>{fileInputRef.current.click();};const handleOptionChange=option=>{setAnalysisOptions(prev=>({...prev,[option]:!prev[option]}));};const submitAnalysis=async()=>{setActiveStep(2);setLoading(true);setError(null);try{const analysisData={projectId:projectId,pomContent:pomContent,checkVulnerabilities:analysisOptions.checkVulnerabilities};console.log('Submitting analysis request:',analysisData);// Use the new method that handles both analysis creation and redirection\nawait api.dependencyAnalysis.startAnalysisAndRedirect(projectId,analysisData,navigate,analysisOptions.notifyOnCompletion?toast:null);// No need to handle redirect here anymore as it's done in the API service\n// The rest of the function's error handling remains as a fallback\n}catch(err){console.error('Error submitting analysis:',err);// Determine error message based on response\nlet errorMessage='An unexpected error occurred. Please try again later.';if(err.response){// Server responded with a non-2xx status\nif(err.response.status===400){errorMessage='Invalid request. Please check your POM file and try again.';}else if(err.response.status===404){errorMessage='Project not found. Please return to the projects page and try again.';}else if(err.response.data&&err.response.data.message){errorMessage=err.response.data.message;}console.error('Server error response:',err.response.data);}else if(err.request){// Request was made but no response received\nerrorMessage='No response from server. Please check your connection and try again.';}setError(errorMessage);setActiveStep(1);// Return to previous step on error\n}finally{setLoading(false);}};if(loading){return/*#__PURE__*/_jsx(Box,{sx:{display:'flex',justifyContent:'center',mt:10},children:/*#__PURE__*/_jsx(CircularProgress,{})});}return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsxs(Box,{sx:{display:'flex',alignItems:'center',mb:3},children:[/*#__PURE__*/_jsx(IconButton,{onClick:()=>navigate(`/projects/${projectId}`),sx:{mr:1},children:/*#__PURE__*/_jsx(ArrowBackIcon,{})}),/*#__PURE__*/_jsx(Typography,{variant:\"h4\",component:\"h1\",children:\"New Dependency Analysis\"})]}),/*#__PURE__*/_jsxs(Paper,{sx:{p:3,mb:4},children:[/*#__PURE__*/_jsxs(Typography,{variant:\"subtitle1\",gutterBottom:true,children:[\"Project: \",/*#__PURE__*/_jsx(\"strong\",{children:project.name})]}),/*#__PURE__*/_jsx(Typography,{variant:\"body2\",color:\"text.secondary\",gutterBottom:true,children:project.description}),/*#__PURE__*/_jsx(Chip,{icon:/*#__PURE__*/_jsx(CodeIcon,{}),label:\"MAVEN\",size:\"small\",sx:{mt:1}})]}),/*#__PURE__*/_jsx(Stepper,{activeStep:activeStep,sx:{mb:4},children:steps.map(label=>/*#__PURE__*/_jsx(Step,{children:/*#__PURE__*/_jsx(StepLabel,{children:label})},label))}),/*#__PURE__*/_jsxs(Paper,{sx:{p:3},children:[activeStep===0&&/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(Typography,{variant:\"h6\",gutterBottom:true,children:\"Select Input Method\"}),/*#__PURE__*/_jsx(Typography,{variant:\"body2\",color:\"text.secondary\",gutterBottom:true,sx:{mb:3},children:\"Choose how you want to provide your project's POM file for analysis.\"}),/*#__PURE__*/_jsxs(Grid,{container:true,spacing:3,children:[/*#__PURE__*/_jsx(Grid,{item:true,xs:12,md:6,children:/*#__PURE__*/_jsx(Card,{variant:\"outlined\",sx:{cursor:'pointer',height:'100%',bgcolor:inputMethod==='file'?'rgba(33, 150, 243, 0.08)':'inherit',border:inputMethod==='file'?'1px solid #2196f3':'1px solid rgba(0, 0, 0, 0.12)'},onClick:()=>setInputMethod('file'),children:/*#__PURE__*/_jsxs(CardContent,{sx:{display:'flex',flexDirection:'column',alignItems:'center',p:4},children:[/*#__PURE__*/_jsx(CloudUploadIcon,{fontSize:\"large\",color:\"primary\",sx:{mb:2}}),/*#__PURE__*/_jsx(Typography,{variant:\"h6\",gutterBottom:true,children:\"Upload POM File\"}),/*#__PURE__*/_jsx(Typography,{variant:\"body2\",color:\"text.secondary\",align:\"center\",children:\"Upload your project's pom.xml file from your computer.\"}),inputMethod==='file'&&/*#__PURE__*/_jsxs(Box,{sx:{mt:3,width:'100%'},children:[/*#__PURE__*/_jsx(\"input\",{ref:fileInputRef,type:\"file\",accept:\".xml\",style:{display:'none'},onChange:handleFileUpload}),/*#__PURE__*/_jsx(Button,{variant:\"outlined\",startIcon:/*#__PURE__*/_jsx(DescriptionIcon,{}),onClick:handleFileClick,fullWidth:true,children:pomFile?pomFile.name:'Select File'}),pomFile&&/*#__PURE__*/_jsxs(Box,{sx:{mt:2,display:'flex',alignItems:'center'},children:[/*#__PURE__*/_jsx(Chip,{label:pomFile.name,onDelete:()=>{setPomFile(null);setPomContent('');}}),/*#__PURE__*/_jsxs(Typography,{variant:\"caption\",color:\"text.secondary\",sx:{ml:1},children:[(pomFile.size/1024).toFixed(2),\" KB\"]})]})]})]})})}),/*#__PURE__*/_jsx(Grid,{item:true,xs:12,md:6,children:/*#__PURE__*/_jsx(Card,{variant:\"outlined\",sx:{cursor:'pointer',height:'100%',bgcolor:inputMethod==='manual'?'rgba(33, 150, 243, 0.08)':'inherit',border:inputMethod==='manual'?'1px solid #2196f3':'1px solid rgba(0, 0, 0, 0.12)'},onClick:()=>setInputMethod('manual'),children:/*#__PURE__*/_jsxs(CardContent,{sx:{display:'flex',flexDirection:'column',alignItems:'center',p:4},children:[/*#__PURE__*/_jsx(CodeIcon,{fontSize:\"large\",color:\"primary\",sx:{mb:2}}),/*#__PURE__*/_jsx(Typography,{variant:\"h6\",gutterBottom:true,children:\"Paste POM Content\"}),/*#__PURE__*/_jsx(Typography,{variant:\"body2\",color:\"text.secondary\",align:\"center\",children:\"Manually paste the content of your pom.xml file.\"}),inputMethod==='manual'&&/*#__PURE__*/_jsx(TextField,{multiline:true,rows:8,fullWidth:true,placeholder:\"Paste your pom.xml content here...\",value:pomContent,onChange:e=>setPomContent(e.target.value),sx:{mt:3}})]})})})]})]}),activeStep===1&&/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(Typography,{variant:\"h6\",gutterBottom:true,children:\"Configure Analysis\"}),/*#__PURE__*/_jsx(Typography,{variant:\"body2\",color:\"text.secondary\",gutterBottom:true,sx:{mb:3},children:\"Customize your dependency analysis options.\"}),/*#__PURE__*/_jsxs(Grid,{container:true,spacing:3,children:[/*#__PURE__*/_jsx(Grid,{item:true,xs:12,md:6,children:/*#__PURE__*/_jsx(Card,{variant:\"outlined\",children:/*#__PURE__*/_jsxs(CardContent,{children:[/*#__PURE__*/_jsx(Typography,{variant:\"subtitle1\",gutterBottom:true,children:\"Analysis Options\"}),/*#__PURE__*/_jsx(Divider,{sx:{mb:2}}),/*#__PURE__*/_jsxs(Box,{sx:{display:'flex',justifyContent:'space-between',mb:1},children:[/*#__PURE__*/_jsx(Typography,{variant:\"body2\",children:\"Check for vulnerabilities\"}),/*#__PURE__*/_jsx(Button,{size:\"small\",variant:analysisOptions.checkVulnerabilities?\"contained\":\"outlined\",color:analysisOptions.checkVulnerabilities?\"primary\":\"inherit\",onClick:()=>handleOptionChange('checkVulnerabilities'),children:analysisOptions.checkVulnerabilities?\"Enabled\":\"Disabled\"})]}),/*#__PURE__*/_jsxs(Box,{sx:{display:'flex',justifyContent:'space-between',mb:1},children:[/*#__PURE__*/_jsx(Typography,{variant:\"body2\",children:\"Check licenses\"}),/*#__PURE__*/_jsx(Button,{size:\"small\",variant:analysisOptions.checkLicenses?\"contained\":\"outlined\",color:analysisOptions.checkLicenses?\"primary\":\"inherit\",onClick:()=>handleOptionChange('checkLicenses'),children:analysisOptions.checkLicenses?\"Enabled\":\"Disabled\"})]}),/*#__PURE__*/_jsxs(Box,{sx:{display:'flex',justifyContent:'space-between',mb:1},children:[/*#__PURE__*/_jsx(Typography,{variant:\"body2\",children:\"Generate report\"}),/*#__PURE__*/_jsx(Button,{size:\"small\",variant:analysisOptions.generateReport?\"contained\":\"outlined\",color:analysisOptions.generateReport?\"primary\":\"inherit\",onClick:()=>handleOptionChange('generateReport'),children:analysisOptions.generateReport?\"Enabled\":\"Disabled\"})]}),/*#__PURE__*/_jsxs(Box,{sx:{display:'flex',justifyContent:'space-between',mb:1},children:[/*#__PURE__*/_jsx(Typography,{variant:\"body2\",children:\"Include transitive dependencies\"}),/*#__PURE__*/_jsx(Button,{size:\"small\",variant:analysisOptions.includeTransitive?\"contained\":\"outlined\",color:analysisOptions.includeTransitive?\"primary\":\"inherit\",onClick:()=>handleOptionChange('includeTransitive'),children:analysisOptions.includeTransitive?\"Enabled\":\"Disabled\"})]}),/*#__PURE__*/_jsxs(Box,{sx:{display:'flex',justifyContent:'space-between'},children:[/*#__PURE__*/_jsx(Typography,{variant:\"body2\",children:\"Notify on completion\"}),/*#__PURE__*/_jsx(Button,{size:\"small\",variant:analysisOptions.notifyOnCompletion?\"contained\":\"outlined\",color:analysisOptions.notifyOnCompletion?\"primary\":\"inherit\",onClick:()=>handleOptionChange('notifyOnCompletion'),children:analysisOptions.notifyOnCompletion?\"Enabled\":\"Disabled\"})]})]})})}),/*#__PURE__*/_jsx(Grid,{item:true,xs:12,md:6,children:inputMethod==='file'&&pomFile||inputMethod==='manual'&&pomContent?/*#__PURE__*/_jsx(Card,{variant:\"outlined\",children:/*#__PURE__*/_jsxs(CardContent,{children:[/*#__PURE__*/_jsx(Typography,{variant:\"subtitle1\",gutterBottom:true,children:\"POM File Preview\"}),/*#__PURE__*/_jsx(Divider,{sx:{mb:2}}),/*#__PURE__*/_jsx(Box,{sx:{maxHeight:250,overflow:'auto',bgcolor:'rgba(0, 0, 0, 0.03)',borderRadius:1,p:2,fontFamily:'monospace',fontSize:'0.875rem',whiteSpace:'pre-wrap'},children:pomContent?pomContent.substring(0,2000)+(pomContent.length>2000?'...':''):'No content to preview'})]})}):/*#__PURE__*/_jsx(Card,{variant:\"outlined\",children:/*#__PURE__*/_jsx(CardContent,{sx:{display:'flex',flexDirection:'column',alignItems:'center',justifyContent:'center',height:'100%',p:4},children:/*#__PURE__*/_jsx(Alert,{severity:\"info\",sx:{width:'100%'},children:\"Please upload or paste your POM file content to see a preview.\"})})})})]})]}),activeStep===2&&/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(Typography,{variant:\"h6\",gutterBottom:true,align:\"center\",children:loading?'Analysis in Progress':'Review & Start Analysis'}),/*#__PURE__*/_jsx(Typography,{variant:\"body2\",color:\"text.secondary\",align:\"center\",sx:{mb:2},children:!loading?'Review your settings and click \"Start Analysis\" when ready.':analysisOptions.checkVulnerabilities?'Processing POM file and initializing vulnerability scanning. You will be redirected to the results page where scanning will continue in the background.':'Processing POM file and analyzing dependencies...'}),loading&&analysisOptions.checkVulnerabilities&&/*#__PURE__*/_jsxs(Box,{sx:{display:'flex',flexDirection:'column',alignItems:'center',mb:4},children:[/*#__PURE__*/_jsx(CircularProgress,{size:60,sx:{mb:2}}),/*#__PURE__*/_jsxs(Box,{sx:{width:'100%',maxWidth:400},children:[/*#__PURE__*/_jsx(Box,{sx:{width:'100%',bgcolor:'background.paper',borderRadius:1,p:1,mb:1},children:/*#__PURE__*/_jsx(Box,{sx:{height:10,width:'100%',bgcolor:'primary.lighter',borderRadius:5,position:'relative',overflow:'hidden'},children:/*#__PURE__*/_jsx(Box,{sx:{position:'absolute',left:0,top:0,height:'100%',bgcolor:'primary.main',width:'30%',borderRadius:5,animation:'pulse 1.5s infinite ease-in-out','@keyframes pulse':{'0%':{opacity:0.6},'50%':{opacity:1},'100%':{opacity:0.6}}}})})}),/*#__PURE__*/_jsxs(Typography,{variant:\"caption\",color:\"text.secondary\",align:\"center\",sx:{display:'block'},children:[/*#__PURE__*/_jsx(Box,{component:\"span\",sx:{fontWeight:'bold',color:'primary.main'},children:\"Security scanning in progress\"}),\" - This may take a moment as we check each dependency for vulnerabilities\"]})]})]}),loading&&!analysisOptions.checkVulnerabilities&&/*#__PURE__*/_jsx(Box,{sx:{display:'flex',justifyContent:'center',mb:4},children:/*#__PURE__*/_jsx(CircularProgress,{})}),!loading&&/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(Typography,{variant:\"h6\",gutterBottom:true,children:\"Review & Start Analysis\"}),/*#__PURE__*/_jsx(Typography,{variant:\"body2\",color:\"text.secondary\",gutterBottom:true,sx:{mb:3},children:\"Review your settings and start the dependency analysis.\"})]}),/*#__PURE__*/_jsxs(Grid,{container:true,spacing:3,children:[/*#__PURE__*/_jsx(Grid,{item:true,xs:12,md:6,children:/*#__PURE__*/_jsx(Card,{variant:\"outlined\",children:/*#__PURE__*/_jsxs(CardContent,{children:[/*#__PURE__*/_jsx(Typography,{variant:\"subtitle1\",gutterBottom:true,children:\"Analysis Summary\"}),/*#__PURE__*/_jsx(Divider,{sx:{mb:2}}),/*#__PURE__*/_jsxs(Box,{sx:{mb:2},children:[/*#__PURE__*/_jsx(Typography,{variant:\"body2\",color:\"text.secondary\",children:\"Project:\"}),/*#__PURE__*/_jsx(Typography,{variant:\"body1\",children:project.name})]}),/*#__PURE__*/_jsxs(Box,{sx:{mb:2},children:[/*#__PURE__*/_jsx(Typography,{variant:\"body2\",color:\"text.secondary\",children:\"Input Method:\"}),/*#__PURE__*/_jsxs(Typography,{variant:\"body1\",children:[inputMethod==='file'?'Uploaded File':'Manual Input',inputMethod==='file'&&pomFile&&/*#__PURE__*/_jsxs(Typography,{variant:\"caption\",sx:{display:'block'},children:[pomFile.name,\" (\",(pomFile.size/1024).toFixed(2),\" KB)\"]})]})]}),/*#__PURE__*/_jsxs(Box,{children:[/*#__PURE__*/_jsx(Typography,{variant:\"body2\",color:\"text.secondary\",gutterBottom:true,children:\"Analysis Options:\"}),/*#__PURE__*/_jsxs(Box,{sx:{pl:2},children:[/*#__PURE__*/_jsxs(Typography,{variant:\"body2\",children:[\"\\u2022 Vulnerability Check: \",/*#__PURE__*/_jsx(\"strong\",{children:analysisOptions.checkVulnerabilities?'Enabled':'Disabled'}),analysisOptions.checkVulnerabilities&&/*#__PURE__*/_jsx(Typography,{variant:\"caption\",display:\"block\",color:\"text.secondary\",sx:{mt:0.5},children:\"Real-time security checks will be performed for each dependency\"})]}),/*#__PURE__*/_jsxs(Typography,{variant:\"body2\",children:[\"\\u2022 License Check: \",/*#__PURE__*/_jsx(\"strong\",{children:analysisOptions.checkLicenses?'Enabled':'Disabled'})]}),/*#__PURE__*/_jsxs(Typography,{variant:\"body2\",children:[\"\\u2022 Report Generation: \",/*#__PURE__*/_jsx(\"strong\",{children:analysisOptions.generateReport?'Enabled':'Disabled'})]}),/*#__PURE__*/_jsxs(Typography,{variant:\"body2\",children:[\"\\u2022 Transitive Dependencies: \",/*#__PURE__*/_jsx(\"strong\",{children:analysisOptions.includeTransitive?'Included':'Excluded'})]}),/*#__PURE__*/_jsxs(Typography,{variant:\"body2\",children:[\"\\u2022 Completion Notification: \",/*#__PURE__*/_jsx(\"strong\",{children:analysisOptions.notifyOnCompletion?'Enabled':'Disabled'})]})]})]})]})})}),/*#__PURE__*/_jsx(Grid,{item:true,xs:12,md:6,children:/*#__PURE__*/_jsx(Card,{variant:\"outlined\",children:/*#__PURE__*/_jsxs(CardContent,{sx:{display:'flex',flexDirection:'column',height:'100%',justifyContent:'space-between'},children:[/*#__PURE__*/_jsxs(Box,{children:[/*#__PURE__*/_jsx(Typography,{variant:\"subtitle1\",gutterBottom:true,children:\"Start Analysis\"}),/*#__PURE__*/_jsx(Divider,{sx:{mb:2}}),/*#__PURE__*/_jsx(Typography,{variant:\"body2\",paragraph:true,children:\"When you click \\\"Start Analysis\\\", the system will:\"}),/*#__PURE__*/_jsxs(Box,{sx:{pl:2,mb:3},children:[/*#__PURE__*/_jsx(Typography,{variant:\"body2\",gutterBottom:true,children:\"1. Parse your POM file\"}),/*#__PURE__*/_jsx(Typography,{variant:\"body2\",gutterBottom:true,children:\"2. Analyze all dependencies\"}),/*#__PURE__*/_jsx(Typography,{variant:\"body2\",gutterBottom:true,children:\"3. Check for updates, vulnerabilities, and license issues\"}),/*#__PURE__*/_jsx(Typography,{variant:\"body2\",gutterBottom:true,children:\"4. Generate reports and visualizations\"})]}),error&&/*#__PURE__*/_jsx(Alert,{severity:\"error\",sx:{mb:3},children:error})]}),/*#__PURE__*/_jsx(Box,{sx:{display:'flex',justifyContent:'flex-end',mt:3},children:/*#__PURE__*/_jsx(Button,{variant:\"contained\",color:\"primary\",size:\"large\",onClick:submitAnalysis,disabled:loading||!(inputMethod==='file'&&pomFile||inputMethod==='manual'&&pomContent),fullWidth:true,sx:{py:1.5,bgcolor:'primary.main','&:hover':{bgcolor:'primary.dark'}},children:loading?/*#__PURE__*/_jsxs(Box,{sx:{display:'flex',alignItems:'center'},children:[/*#__PURE__*/_jsx(CircularProgress,{size:24,color:\"inherit\",sx:{mr:1}}),\"Starting Analysis...\"]}):'Start Analysis'})})]})})})]})]}),/*#__PURE__*/_jsxs(Box,{sx:{display:'flex',justifyContent:'space-between',mt:3},children:[/*#__PURE__*/_jsx(Button,{disabled:activeStep===0,onClick:handleBack,children:\"Back\"}),/*#__PURE__*/_jsx(Button,{variant:\"contained\",onClick:handleNext,disabled:activeStep===steps.length-1||activeStep===0&&!(inputMethod==='file'&&pomFile||inputMethod==='manual'&&pomContent),children:\"Next\"})]})]})]});};export default NewAnalysis;","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}