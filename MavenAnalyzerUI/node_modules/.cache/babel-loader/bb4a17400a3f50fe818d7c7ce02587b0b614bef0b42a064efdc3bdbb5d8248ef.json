{"ast":null,"code":"import React,{useState,useEffect}from'react';import{Typography,Paper,Box,Grid,Card,CardContent,CardHeader,Divider,CircularProgress,Button,Tabs,Tab,FormControl,InputLabel,Select,MenuItem}from'@mui/material';import{useNavigate}from'react-router-dom';import api from'../services/api';// Tab Panel component for the tabs\nimport{jsx as _jsx,jsxs as _jsxs,Fragment as _Fragment}from\"react/jsx-runtime\";function TabPanel(props){const{children,value,index,...other}=props;return/*#__PURE__*/_jsx(\"div\",{role:\"tabpanel\",hidden:value!==index,id:`chart-tabpanel-${index}`,\"aria-labelledby\":`chart-tab-${index}`,...other,children:value===index&&/*#__PURE__*/_jsx(Box,{sx:{pt:3},children:children})});}const Charts=()=>{const navigate=useNavigate();const[loading,setLoading]=useState(true);const[analyses,setAnalyses]=useState([]);const[projects,setProjects]=useState([]);const[selectedAnalysisId,setSelectedAnalysisId]=useState('');const[tabValue,setTabValue]=useState(0);const[charts,setCharts]=useState({dependencyUpdates:null,vulnerabilities:null,licenses:null});// Fetch analyses and projects\nuseEffect(()=>{const fetchData=async()=>{setLoading(true);try{// Fetch all projects\nconst projectsResponse=await api.projects.getAll();setProjects(projectsResponse.data);// Fetch all analyses\nconst analysesResponse=await api.dependencyAnalysis.getAll();const analysesData=analysesResponse.data;// Enrich analyses with project names\nconst enrichedAnalyses=analysesData.map(analysis=>{const project=projectsResponse.data.find(p=>p.id===analysis.projectId);return{...analysis,projectName:project?project.name:`Project ${analysis.projectId}`,id:analysis.analysisId,// Map analysisId to id for consistency\ndate:new Date(analysis.analysisDate).toLocaleString()// Format date for display\n};});setAnalyses(enrichedAnalyses);// Set default selected analysis to the most recent one if available\nif(enrichedAnalyses.length>0){setSelectedAnalysisId(enrichedAnalyses[0].id);}}catch(error){console.error('Error fetching data:',error);}finally{setLoading(false);}};fetchData();},[]);// Fetch charts when selected analysis changes\nuseEffect(()=>{const fetchCharts=async()=>{if(!selectedAnalysisId)return;setLoading(true);try{// Fetch different chart types\nconst dependencyUpdatesResponse=await api.charts.getDependencyUpdates(selectedAnalysisId);const vulnerabilitiesResponse=await api.charts.getVulnerabilities(selectedAnalysisId);const licenseDistributionResponse=await api.charts.getLicenseDistribution(selectedAnalysisId);setCharts({dependencyUpdates:dependencyUpdatesResponse.data,vulnerabilities:vulnerabilitiesResponse.data,licenses:licenseDistributionResponse.data});}catch(error){console.error('Error fetching charts:',error);}finally{setLoading(false);}};fetchCharts();},[selectedAnalysisId]);const handleChangeTab=(event,newValue)=>{setTabValue(newValue);};const handleAnalysisChange=event=>{setSelectedAnalysisId(event.target.value);};const getSelectedAnalysis=()=>{return analyses.find(analysis=>analysis.id===selectedAnalysisId)||{};};return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(Typography,{variant:\"h4\",component:\"h1\",gutterBottom:true,children:\"Visualization Charts\"}),/*#__PURE__*/_jsxs(Paper,{sx:{p:3,mb:3},children:[/*#__PURE__*/_jsx(Typography,{variant:\"h6\",gutterBottom:true,children:\"Select Analysis\"}),loading&&analyses.length===0?/*#__PURE__*/_jsx(Box,{sx:{display:'flex',justifyContent:'center',p:3},children:/*#__PURE__*/_jsx(CircularProgress,{})}):/*#__PURE__*/_jsxs(FormControl,{fullWidth:true,children:[/*#__PURE__*/_jsx(InputLabel,{children:\"Analysis\"}),/*#__PURE__*/_jsx(Select,{value:selectedAnalysisId,onChange:handleAnalysisChange,label:\"Analysis\",children:analyses.map(analysis=>/*#__PURE__*/_jsxs(MenuItem,{value:analysis.id,children:[analysis.projectName,\" - \",analysis.date]},analysis.id))})]})]}),selectedAnalysisId&&/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsxs(Paper,{sx:{p:0,mb:3},children:[/*#__PURE__*/_jsx(Box,{sx:{borderBottom:1,borderColor:'divider'},children:/*#__PURE__*/_jsxs(Tabs,{value:tabValue,onChange:handleChangeTab,\"aria-label\":\"chart tabs\",children:[/*#__PURE__*/_jsx(Tab,{label:\"Dependency Updates\"}),/*#__PURE__*/_jsx(Tab,{label:\"Vulnerabilities\"}),/*#__PURE__*/_jsx(Tab,{label:\"License Distribution\"})]})}),/*#__PURE__*/_jsxs(Box,{sx:{p:3},children:[/*#__PURE__*/_jsxs(TabPanel,{value:tabValue,index:0,children:[/*#__PURE__*/_jsx(Typography,{variant:\"h6\",gutterBottom:true,children:\"Dependency Update Status\"}),loading?/*#__PURE__*/_jsx(Box,{sx:{display:'flex',justifyContent:'center',p:3},children:/*#__PURE__*/_jsx(CircularProgress,{})}):charts.dependencyUpdates?/*#__PURE__*/_jsxs(Box,{sx:{mt:2},children:[/*#__PURE__*/_jsx(\"img\",{src:`${process.env.REACT_APP_API_BASE_URL||'http://localhost:8080/api'}/static/charts/${charts.dependencyUpdates.chartPath}`,alt:\"Dependency Updates Chart\",style:{maxWidth:'100%',height:'auto'}}),/*#__PURE__*/_jsx(Typography,{variant:\"body1\",sx:{mt:2},children:charts.dependencyUpdates.description})]}):/*#__PURE__*/_jsx(Typography,{children:\"No dependency update chart available for this analysis.\"}),/*#__PURE__*/_jsx(Box,{sx:{mt:3},children:/*#__PURE__*/_jsxs(Grid,{container:true,spacing:3,children:[/*#__PURE__*/_jsx(Grid,{item:true,xs:12,md:4,children:/*#__PURE__*/_jsxs(Card,{children:[/*#__PURE__*/_jsx(CardHeader,{title:\"Up-to-date\"}),/*#__PURE__*/_jsx(CardContent,{children:/*#__PURE__*/_jsx(Typography,{variant:\"h3\",color:\"success.main\",align:\"center\",children:getSelectedAnalysis().upToDateDependencies||0})})]})}),/*#__PURE__*/_jsx(Grid,{item:true,xs:12,md:4,children:/*#__PURE__*/_jsxs(Card,{children:[/*#__PURE__*/_jsx(CardHeader,{title:\"Outdated\"}),/*#__PURE__*/_jsx(CardContent,{children:/*#__PURE__*/_jsx(Typography,{variant:\"h3\",color:\"warning.main\",align:\"center\",children:getSelectedAnalysis().outdatedDependencies||0})})]})}),/*#__PURE__*/_jsx(Grid,{item:true,xs:12,md:4,children:/*#__PURE__*/_jsxs(Card,{children:[/*#__PURE__*/_jsx(CardHeader,{title:\"Unknown\"}),/*#__PURE__*/_jsx(CardContent,{children:/*#__PURE__*/_jsx(Typography,{variant:\"h3\",color:\"text.secondary\",align:\"center\",children:getSelectedAnalysis().unidentifiedDependencies||0})})]})})]})})]}),/*#__PURE__*/_jsxs(TabPanel,{value:tabValue,index:1,children:[/*#__PURE__*/_jsx(Typography,{variant:\"h6\",gutterBottom:true,children:\"Vulnerability Status\"}),loading?/*#__PURE__*/_jsx(Box,{sx:{display:'flex',justifyContent:'center',p:3},children:/*#__PURE__*/_jsx(CircularProgress,{})}):charts.vulnerabilities?/*#__PURE__*/_jsxs(Box,{sx:{mt:2},children:[/*#__PURE__*/_jsx(\"img\",{src:`${process.env.REACT_APP_API_BASE_URL||'http://localhost:8080/api'}/static/charts/${charts.vulnerabilities.chartPath}`,alt:\"Vulnerabilities Chart\",style:{maxWidth:'100%',height:'auto'}}),/*#__PURE__*/_jsx(Typography,{variant:\"body1\",sx:{mt:2},children:charts.vulnerabilities.description})]}):/*#__PURE__*/_jsx(Typography,{children:\"No vulnerability chart available for this analysis.\"}),/*#__PURE__*/_jsx(Box,{sx:{mt:3},children:/*#__PURE__*/_jsxs(Card,{children:[/*#__PURE__*/_jsx(CardHeader,{title:\"Vulnerability Summary\"}),/*#__PURE__*/_jsx(CardContent,{children:/*#__PURE__*/_jsxs(Typography,{variant:\"body1\",children:[\"Total vulnerabilities found: \",/*#__PURE__*/_jsx(\"strong\",{children:getSelectedAnalysis().vulnerableCount||0})]})})]})})]}),/*#__PURE__*/_jsxs(TabPanel,{value:tabValue,index:2,children:[/*#__PURE__*/_jsx(Typography,{variant:\"h6\",gutterBottom:true,children:\"License Distribution\"}),loading?/*#__PURE__*/_jsx(Box,{sx:{display:'flex',justifyContent:'center',p:3},children:/*#__PURE__*/_jsx(CircularProgress,{})}):charts.licenses?/*#__PURE__*/_jsxs(Box,{sx:{mt:2},children:[/*#__PURE__*/_jsx(\"img\",{src:`${process.env.REACT_APP_API_BASE_URL||'http://localhost:8080/api'}/static/charts/${charts.licenses.chartPath}`,alt:\"License Distribution Chart\",style:{maxWidth:'100%',height:'auto'}}),/*#__PURE__*/_jsx(Typography,{variant:\"body1\",sx:{mt:2},children:charts.licenses.description})]}):/*#__PURE__*/_jsx(Typography,{children:\"No license distribution chart available for this analysis.\"})]})]})]}),/*#__PURE__*/_jsx(Box,{sx:{display:'flex',justifyContent:'flex-end',mt:3},children:/*#__PURE__*/_jsx(Button,{variant:\"contained\",onClick:()=>navigate(`/analysis/${selectedAnalysisId}`),children:\"View Analysis Details\"})})]})]});};export default Charts;","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}