{"ast":null,"code":"import React,{useState,useEffect}from'react';import{useParams,useNavigate,Link as RouterLink}from'react-router-dom';import{Typography,Box,Paper,Grid,Button,Card,CardContent,CardHeader,Divider,Tabs,Tab,List,ListItem,ListItemText,ListItemIcon,ListItemSecondaryAction,IconButton,Chip,CircularProgress,TextField,Dialog,DialogTitle,DialogContent,DialogContentText,DialogActions,Alert}from'@mui/material';import AddIcon from'@mui/icons-material/Add';import EditIcon from'@mui/icons-material/Edit';import DeleteIcon from'@mui/icons-material/Delete';import HistoryIcon from'@mui/icons-material/History';import AssessmentIcon from'@mui/icons-material/Assessment';import WarningIcon from'@mui/icons-material/Warning';import UpdateIcon from'@mui/icons-material/Update';import ArrowForwardIcon from'@mui/icons-material/ArrowForward';import api from'../services/api';// Tab panel component for tab content\nimport{jsx as _jsx,jsxs as _jsxs,Fragment as _Fragment}from\"react/jsx-runtime\";function TabPanel(props){const{children,value,index,...other}=props;return/*#__PURE__*/_jsx(\"div\",{role:\"tabpanel\",hidden:value!==index,id:`project-tabpanel-${index}`,\"aria-labelledby\":`project-tab-${index}`,...other,children:value===index&&/*#__PURE__*/_jsx(Box,{sx:{p:3},children:children})});}const ProjectDetail=()=>{const{id}=useParams();const navigate=useNavigate();const[loading,setLoading]=useState(true);const[error,setError]=useState(null);const[project,setProject]=useState(null);const[analyses,setAnalyses]=useState([]);const[tabValue,setTabValue]=useState(0);const[deleteDialogOpen,setDeleteDialogOpen]=useState(false);const[editDialogOpen,setEditDialogOpen]=useState(false);const[newName,setNewName]=useState('');const[newDescription,setNewDescription]=useState('');useEffect(()=>{const fetchProjectData=async()=>{setLoading(true);setError(null);try{// Fetch project details\nconst projectResponse=await api.projects.getById(id);setProject(projectResponse.data);setNewName(projectResponse.data.name);setNewDescription(projectResponse.data.description||'');// Fetch analyses for this project\ntry{const analysesResponse=await api.dependencyAnalysis.getByProject(id);if(analysesResponse.data&&analysesResponse.data.length>0){// Format the date for each analysis and ensure id is properly mapped\nconst formattedAnalyses=analysesResponse.data.map(analysis=>({...analysis,id:analysis.analysisId,// Map analysisId to id for consistency\ndate:analysis.analysisDate?new Date(analysis.analysisDate).toLocaleString():'Unknown'}));setAnalyses(formattedAnalyses);console.log('Analyses loaded:',formattedAnalyses);}else{console.log('No analyses found for project');setAnalyses([]);}}catch(analysesError){console.error('Error fetching analyses:',analysesError);setAnalyses([]);}}catch(projectError){console.error('Error fetching project:',projectError);setError('Failed to load project data. Please try again.');setProject(null);}finally{setLoading(false);}};fetchProjectData();},[id]);const handleTabChange=(event,newValue)=>{setTabValue(newValue);};const handleDelete=async()=>{try{setLoading(true);await api.projects.delete(id);setDeleteDialogOpen(false);navigate('/projects',{state:{alert:{type:'success',message:'Project deleted successfully'}}});}catch(err){console.error('Error deleting project:',err);setError({severity:'error',message:'Failed to delete project. Please try again later.'});setLoading(false);}};const handleEdit=async()=>{if(!newName.trim())return;try{setLoading(true);const updatedProject={...project,name:newName,description:newDescription};const response=await api.projects.update(id,updatedProject);setProject(response.data);setEditDialogOpen(false);setLoading(false);}catch(err){console.error('Error updating project:',err);setError({severity:'error',message:'Failed to update project. Please try again later.'});setLoading(false);}};const handleSaveChanges=async()=>{try{setLoading(true);const response=await api.projects.update(id,project);setProject(response.data);setLoading(false);// Show a temporary success message\nsetError({severity:'success',message:'Project updated successfully'});setTimeout(()=>setError(null),3000);}catch(err){console.error('Error updating project:',err);setError({severity:'error',message:'Failed to save changes. Please try again later.'});setLoading(false);}};if(loading&&!project){return/*#__PURE__*/_jsx(Box,{sx:{display:'flex',justifyContent:'center',mt:10},children:/*#__PURE__*/_jsx(CircularProgress,{})});}// Critical error that prevents rendering the whole component\nif(error&&typeof error==='string'){return/*#__PURE__*/_jsx(Box,{sx:{mt:3},children:/*#__PURE__*/_jsx(Alert,{severity:\"error\",children:error})});}return/*#__PURE__*/_jsxs(_Fragment,{children:[error&&typeof error==='object'&&/*#__PURE__*/_jsx(Alert,{severity:error.severity,sx:{mb:2},onClose:()=>setError(null),children:error.message}),/*#__PURE__*/_jsxs(Box,{sx:{display:'flex',justifyContent:'space-between',alignItems:'center',mb:3},children:[/*#__PURE__*/_jsx(Typography,{variant:\"h4\",component:\"h1\",children:project.name}),/*#__PURE__*/_jsxs(Box,{children:[/*#__PURE__*/_jsx(Button,{variant:\"outlined\",startIcon:/*#__PURE__*/_jsx(EditIcon,{}),sx:{mr:1},onClick:()=>setEditDialogOpen(true),children:\"Edit\"}),/*#__PURE__*/_jsx(Button,{variant:\"outlined\",color:\"error\",startIcon:/*#__PURE__*/_jsx(DeleteIcon,{}),onClick:()=>setDeleteDialogOpen(true),children:\"Delete\"})]})]}),/*#__PURE__*/_jsx(Paper,{sx:{p:3,mb:4},children:/*#__PURE__*/_jsxs(Grid,{container:true,spacing:3,children:[/*#__PURE__*/_jsxs(Grid,{item:true,xs:12,md:8,children:[/*#__PURE__*/_jsx(Typography,{variant:\"body1\",paragraph:true,children:project.description||'No description provided.'}),/*#__PURE__*/_jsxs(Box,{sx:{display:'flex',flexWrap:'wrap',gap:1},children:[/*#__PURE__*/_jsx(Chip,{label:\"Type: MAVEN\",variant:\"outlined\"}),/*#__PURE__*/_jsx(Chip,{label:`Created: ${project.createdAt||'N/A'}`,variant:\"outlined\"}),/*#__PURE__*/_jsx(Chip,{label:`Last Analysis: ${project.lastAnalysis||'N/A'}`,variant:\"outlined\"})]})]}),/*#__PURE__*/_jsx(Grid,{item:true,xs:12,md:4,sx:{display:'flex',justifyContent:{xs:'flex-start',md:'flex-end'},alignItems:'flex-start'},children:/*#__PURE__*/_jsx(Button,{variant:\"contained\",startIcon:/*#__PURE__*/_jsx(AddIcon,{}),onClick:()=>navigate(`/projects/${id}/new-analysis`),size:\"large\",children:\"New Analysis\"})})]})}),/*#__PURE__*/_jsxs(Paper,{sx:{mb:4},children:[/*#__PURE__*/_jsx(Box,{sx:{borderBottom:1,borderColor:'divider'},children:/*#__PURE__*/_jsxs(Tabs,{value:tabValue,onChange:handleTabChange,\"aria-label\":\"project tabs\",children:[/*#__PURE__*/_jsx(Tab,{label:\"Overview\"}),/*#__PURE__*/_jsx(Tab,{label:\"Analysis History\"}),/*#__PURE__*/_jsx(Tab,{label:\"Settings\"})]})}),/*#__PURE__*/_jsx(TabPanel,{value:tabValue,index:0,children:/*#__PURE__*/_jsxs(Grid,{container:true,spacing:3,children:[/*#__PURE__*/_jsx(Grid,{item:true,xs:12,md:6,children:/*#__PURE__*/_jsxs(Card,{children:[/*#__PURE__*/_jsx(CardHeader,{title:\"Latest Analysis\",action:analyses.length>0?/*#__PURE__*/_jsx(Button,{component:RouterLink,to:`/analysis/${analyses[0].id}`,size:\"small\",endIcon:/*#__PURE__*/_jsx(ArrowForwardIcon,{}),children:\"View Details\"}):/*#__PURE__*/_jsx(Button,{component:RouterLink,to:`/projects/${id}/new-analysis`,size:\"small\",startIcon:/*#__PURE__*/_jsx(AddIcon,{}),children:\"New Analysis\"})}),/*#__PURE__*/_jsx(Divider,{}),/*#__PURE__*/_jsx(CardContent,{children:analyses.length>0?/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsxs(Typography,{variant:\"body2\",color:\"text.secondary\",gutterBottom:true,children:[\"Analyzed on \",analyses[0].date]}),/*#__PURE__*/_jsxs(Grid,{container:true,spacing:2,sx:{mt:1},children:[/*#__PURE__*/_jsx(Grid,{item:true,xs:4,children:/*#__PURE__*/_jsxs(Box,{sx:{textAlign:'center'},children:[/*#__PURE__*/_jsx(Typography,{variant:\"h5\",children:analyses[0].totalDependencies}),/*#__PURE__*/_jsx(Typography,{variant:\"body2\",color:\"text.secondary\",children:\"Dependencies\"})]})}),/*#__PURE__*/_jsx(Grid,{item:true,xs:4,children:/*#__PURE__*/_jsxs(Box,{sx:{textAlign:'center'},children:[/*#__PURE__*/_jsx(Typography,{variant:\"h5\",color:\"warning.main\",children:analyses[0].outdatedDependencies}),/*#__PURE__*/_jsx(Typography,{variant:\"body2\",color:\"text.secondary\",children:\"Outdated\"})]})}),/*#__PURE__*/_jsx(Grid,{item:true,xs:4,children:/*#__PURE__*/_jsxs(Box,{sx:{textAlign:'center'},children:[/*#__PURE__*/_jsx(Typography,{variant:\"h5\",color:\"error.main\",children:analyses[0].vulnerableCount||0}),/*#__PURE__*/_jsx(Typography,{variant:\"body2\",color:\"text.secondary\",children:\"Vulnerabilities\"})]})})]})]}):/*#__PURE__*/_jsxs(Box,{sx:{textAlign:'center',py:3},children:[/*#__PURE__*/_jsx(Typography,{variant:\"body1\",gutterBottom:true,children:\"No analyses found for this project.\"}),/*#__PURE__*/_jsx(Button,{variant:\"contained\",startIcon:/*#__PURE__*/_jsx(AddIcon,{}),onClick:()=>navigate(`/projects/${id}/new-analysis`),sx:{mt:2},children:\"Start First Analysis\"})]})})]})}),/*#__PURE__*/_jsx(Grid,{item:true,xs:12,md:6,children:/*#__PURE__*/_jsxs(Card,{children:[/*#__PURE__*/_jsx(CardHeader,{title:\"Project Summary\"}),/*#__PURE__*/_jsx(Divider,{}),/*#__PURE__*/_jsx(CardContent,{children:/*#__PURE__*/_jsxs(List,{dense:true,children:[/*#__PURE__*/_jsxs(ListItem,{children:[/*#__PURE__*/_jsx(ListItemIcon,{children:/*#__PURE__*/_jsx(AssessmentIcon,{})}),/*#__PURE__*/_jsx(ListItemText,{primary:\"Total Analyses\",secondary:analyses.length})]}),/*#__PURE__*/_jsxs(ListItem,{children:[/*#__PURE__*/_jsx(ListItemIcon,{children:/*#__PURE__*/_jsx(HistoryIcon,{})}),/*#__PURE__*/_jsx(ListItemText,{primary:\"Last Analysis\",secondary:analyses.length>0?analyses[0].date:'Never'})]}),analyses.length>0&&/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsxs(ListItem,{children:[/*#__PURE__*/_jsx(ListItemIcon,{children:/*#__PURE__*/_jsx(UpdateIcon,{})}),/*#__PURE__*/_jsx(ListItemText,{primary:\"Outdated Dependencies\",secondary:`${analyses[0].outdatedDependencies} of ${analyses[0].totalDependencies}`})]}),/*#__PURE__*/_jsxs(ListItem,{children:[/*#__PURE__*/_jsx(ListItemIcon,{children:/*#__PURE__*/_jsx(WarningIcon,{})}),/*#__PURE__*/_jsx(ListItemText,{primary:\"Security Vulnerabilities\",secondary:analyses[0].vulnerableCount||0})]})]})]})})]})}),analyses.length>0&&analyses[0].vulnerableCount>0&&/*#__PURE__*/_jsx(Grid,{item:true,xs:12,children:/*#__PURE__*/_jsx(Card,{sx:{bgcolor:'error.lighter',borderLeft:'4px solid',borderColor:'error.main'},children:/*#__PURE__*/_jsx(CardContent,{children:/*#__PURE__*/_jsxs(Box,{sx:{display:'flex',alignItems:'center'},children:[/*#__PURE__*/_jsx(WarningIcon,{color:\"error\",sx:{fontSize:40,mr:2}}),/*#__PURE__*/_jsxs(Box,{children:[/*#__PURE__*/_jsxs(Typography,{variant:\"h6\",color:\"error.main\",gutterBottom:true,children:[\"Security Alert: \",analyses[0].vulnerableCount,\" vulnerabilities detected\"]}),/*#__PURE__*/_jsx(Typography,{variant:\"body2\",children:\"Your project has dependencies with known security vulnerabilities that should be addressed. View the latest analysis for details and recommendations.\"})]}),/*#__PURE__*/_jsx(Box,{sx:{ml:'auto'},children:/*#__PURE__*/_jsx(Button,{variant:\"contained\",color:\"error\",component:RouterLink,to:`/analysis/${analyses[0].id}`,endIcon:/*#__PURE__*/_jsx(ArrowForwardIcon,{}),children:\"View Vulnerabilities\"})})]})})})})]})}),/*#__PURE__*/_jsxs(TabPanel,{value:tabValue,index:1,children:[/*#__PURE__*/_jsx(Typography,{variant:\"h6\",gutterBottom:true,children:\"Analysis History\"}),analyses.length>0?/*#__PURE__*/_jsx(List,{children:analyses.map(analysis=>/*#__PURE__*/_jsx(Paper,{sx:{mb:2},children:/*#__PURE__*/_jsx(ListItem,{button:true,component:RouterLink,to:`/analysis/${analysis.id}`,sx:{display:'block',p:0},children:/*#__PURE__*/_jsxs(Box,{sx:{p:2,display:'flex',alignItems:'center',justifyContent:'space-between'},children:[/*#__PURE__*/_jsxs(Box,{children:[/*#__PURE__*/_jsxs(Typography,{variant:\"subtitle1\",children:[\"Analysis \",analysis.id?` ${analysis.id}`:'']}),/*#__PURE__*/_jsxs(Typography,{variant:\"body2\",color:\"text.secondary\",children:[\"Completed on \",analysis.date]})]}),/*#__PURE__*/_jsxs(Box,{sx:{display:'flex',gap:2},children:[/*#__PURE__*/_jsx(Chip,{label:`${analysis.totalDependencies} Dependencies`,variant:\"outlined\",size:\"small\"}),/*#__PURE__*/_jsx(Chip,{label:`${analysis.outdatedDependencies} Outdated`,color:\"warning\",variant:\"outlined\",size:\"small\"}),/*#__PURE__*/_jsx(Chip,{label:`${analysis.vulnerableCount||0} Vulnerabilities`,color:\"error\",variant:\"outlined\",size:\"small\"}),/*#__PURE__*/_jsx(IconButton,{size:\"small\",children:/*#__PURE__*/_jsx(ArrowForwardIcon,{fontSize:\"small\"})})]})]})})},analysis.id))}):/*#__PURE__*/_jsxs(Box,{sx:{textAlign:'center',py:4},children:[/*#__PURE__*/_jsx(Typography,{variant:\"body1\",gutterBottom:true,children:\"No analyses found for this project.\"}),/*#__PURE__*/_jsx(Button,{variant:\"contained\",startIcon:/*#__PURE__*/_jsx(AddIcon,{}),onClick:()=>navigate(`/projects/${id}/new-analysis`),sx:{mt:2},children:\"Start First Analysis\"})]})]}),/*#__PURE__*/_jsxs(TabPanel,{value:tabValue,index:2,children:[/*#__PURE__*/_jsx(Typography,{variant:\"h6\",gutterBottom:true,children:\"Project Settings\"}),/*#__PURE__*/_jsxs(Grid,{container:true,spacing:3,children:[/*#__PURE__*/_jsx(Grid,{item:true,xs:12,md:6,children:/*#__PURE__*/_jsxs(Card,{children:[/*#__PURE__*/_jsx(CardHeader,{title:\"General Settings\"}),/*#__PURE__*/_jsx(Divider,{}),/*#__PURE__*/_jsxs(CardContent,{children:[/*#__PURE__*/_jsx(TextField,{label:\"Project Name\",fullWidth:true,value:project.name,variant:\"outlined\",sx:{mb:3},onChange:e=>setProject({...project,name:e.target.value})}),/*#__PURE__*/_jsx(TextField,{label:\"Description\",fullWidth:true,multiline:true,rows:4,value:project.description,variant:\"outlined\",sx:{mb:3},onChange:e=>setProject({...project,description:e.target.value})}),/*#__PURE__*/_jsx(Button,{variant:\"contained\",onClick:handleSaveChanges,children:\"Save Changes\"})]})]})}),/*#__PURE__*/_jsx(Grid,{item:true,xs:12,md:6,children:/*#__PURE__*/_jsxs(Card,{children:[/*#__PURE__*/_jsx(CardHeader,{title:\"Danger Zone\",sx:{color:'error.main'}}),/*#__PURE__*/_jsx(Divider,{}),/*#__PURE__*/_jsxs(CardContent,{children:[/*#__PURE__*/_jsx(Typography,{variant:\"body2\",paragraph:true,children:\"Deleting this project will remove all associated data, including analyses and reports. This action cannot be undone.\"}),/*#__PURE__*/_jsx(Button,{variant:\"outlined\",color:\"error\",startIcon:/*#__PURE__*/_jsx(DeleteIcon,{}),onClick:()=>setDeleteDialogOpen(true),children:\"Delete Project\"})]})]})})]})]})]}),/*#__PURE__*/_jsxs(Dialog,{open:deleteDialogOpen,onClose:()=>setDeleteDialogOpen(false),children:[/*#__PURE__*/_jsx(DialogTitle,{children:\"Delete Project?\"}),/*#__PURE__*/_jsx(DialogContent,{children:/*#__PURE__*/_jsxs(DialogContentText,{children:[\"Are you sure you want to delete \",/*#__PURE__*/_jsx(\"strong\",{children:project.name}),\"? This action cannot be undone and all project data, including analyses and reports, will be permanently removed.\"]})}),/*#__PURE__*/_jsxs(DialogActions,{children:[/*#__PURE__*/_jsx(Button,{onClick:()=>setDeleteDialogOpen(false),children:\"Cancel\"}),/*#__PURE__*/_jsx(Button,{onClick:handleDelete,color:\"error\",children:\"Delete\"})]})]}),/*#__PURE__*/_jsxs(Dialog,{open:editDialogOpen,onClose:()=>setEditDialogOpen(false),children:[/*#__PURE__*/_jsx(DialogTitle,{children:\"Edit Project\"}),/*#__PURE__*/_jsxs(DialogContent,{children:[/*#__PURE__*/_jsx(DialogContentText,{sx:{mb:2},children:\"Update project information.\"}),/*#__PURE__*/_jsx(TextField,{autoFocus:true,label:\"Project Name\",fullWidth:true,value:newName,onChange:e=>setNewName(e.target.value),margin:\"normal\"}),/*#__PURE__*/_jsx(TextField,{label:\"Description\",fullWidth:true,multiline:true,rows:4,value:newDescription,onChange:e=>setNewDescription(e.target.value),margin:\"normal\"})]}),/*#__PURE__*/_jsxs(DialogActions,{children:[/*#__PURE__*/_jsx(Button,{onClick:()=>setEditDialogOpen(false),children:\"Cancel\"}),/*#__PURE__*/_jsx(Button,{onClick:handleEdit,color:\"primary\",disabled:!newName.trim(),children:\"Save\"})]})]})]});};export default ProjectDetail;","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}