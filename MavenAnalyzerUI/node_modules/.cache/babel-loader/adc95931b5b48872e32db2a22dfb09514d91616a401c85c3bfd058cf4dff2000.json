{"ast":null,"code":"import React,{useState,useEffect}from'react';import{Typography,Paper,Table,TableBody,TableCell,TableContainer,TableHead,TableRow,Button,Box,TextField,InputAdornment,IconButton,CircularProgress,Chip,Dialog,DialogTitle,DialogContent,DialogActions,FormControl,InputLabel,MenuItem,Select,Snackbar,Alert,Menu,ListItemIcon,ListItemText}from'@mui/material';import{Link as RouterLink,useNavigate}from'react-router-dom';import AddIcon from'@mui/icons-material/Add';import SearchIcon from'@mui/icons-material/Search';import MoreVertIcon from'@mui/icons-material/MoreVert';import FilterListIcon from'@mui/icons-material/FilterList';import EditIcon from'@mui/icons-material/Edit';import DeleteIcon from'@mui/icons-material/Delete';import api from'../services/api';import{jsx as _jsx,jsxs as _jsxs,Fragment as _Fragment}from\"react/jsx-runtime\";const Projects=()=>{const navigate=useNavigate();const[loading,setLoading]=useState(true);const[projects,setProjects]=useState([]);const[search,setSearch]=useState('');const[openNewProject,setOpenNewProject]=useState(false);const[newProject,setNewProject]=useState({name:'',description:''});const[snackbar,setSnackbar]=useState({open:false,message:'',severity:'info'});// Add states for menu\nconst[menuAnchorEl,setMenuAnchorEl]=useState(null);const[selectedProject,setSelectedProject]=useState(null);// Add state for edit dialog\nconst[openEditProject,setOpenEditProject]=useState(false);const[editProjectData,setEditProjectData]=useState({name:'',description:''});// Add state for delete confirmation dialog\nconst[openDeleteDialog,setOpenDeleteDialog]=useState(false);const closeSnackbar=()=>{setSnackbar({...snackbar,open:false});};useEffect(()=>{// Fetch projects from the API\nfetchProjects();},[]);const fetchProjects=async()=>{setLoading(true);try{const response=await api.projects.getAll();console.log('API Response:',response.data);setProjects(response.data||[]);}catch(error){console.error('Error fetching projects:',error);setSnackbar({open:true,message:'Failed to load projects. Please try again.',severity:'error'});// Set empty array if error occurs\nsetProjects([]);}finally{setLoading(false);}};const handleCreateProject=async()=>{if(!newProject.name){setSnackbar({open:true,message:'Project name is required',severity:'warning'});return;}try{console.log('Creating project with data:',newProject);const response=await api.projects.create(newProject);console.log('Create project response:',response.data);// Add the new project to the list\nsetProjects([...projects,response.data]);// Reset form and close dialog\nsetOpenNewProject(false);setNewProject({name:'',description:''});setSnackbar({open:true,message:'Project created successfully!',severity:'success'});// Navigate to the new project\nnavigate(`/projects/${response.data.id}`);}catch(error){var _error$response,_error$response$data;console.error('Error creating project:',error);setSnackbar({open:true,message:`Failed to create project: ${((_error$response=error.response)===null||_error$response===void 0?void 0:(_error$response$data=_error$response.data)===null||_error$response$data===void 0?void 0:_error$response$data.message)||error.message}`,severity:'error'});}};// Handler for opening menu\nconst handleMenuOpen=(event,project)=>{setMenuAnchorEl(event.currentTarget);setSelectedProject(project);};// Handler for closing menu\nconst handleMenuClose=()=>{setMenuAnchorEl(null);};// Handler for edit option\nconst handleEditClick=()=>{if(selectedProject){setEditProjectData({name:selectedProject.name,description:selectedProject.description||''});setOpenEditProject(true);}handleMenuClose();};// Handler for delete option\nconst handleDeleteClick=()=>{setOpenDeleteDialog(true);handleMenuClose();};// Handler for updating a project\nconst handleUpdateProject=async()=>{if(!editProjectData.name){setSnackbar({open:true,message:'Project name is required',severity:'warning'});return;}try{const response=await api.projects.update(selectedProject.id,editProjectData);// Update the project in the list\nsetProjects(projects.map(project=>project.id===selectedProject.id?response.data:project));// Close dialog and reset form\nsetOpenEditProject(false);setEditProjectData({name:'',description:''});setSnackbar({open:true,message:'Project updated successfully!',severity:'success'});}catch(error){var _error$response2,_error$response2$data;console.error('Error updating project:',error);setSnackbar({open:true,message:`Failed to update project: ${((_error$response2=error.response)===null||_error$response2===void 0?void 0:(_error$response2$data=_error$response2.data)===null||_error$response2$data===void 0?void 0:_error$response2$data.message)||error.message}`,severity:'error'});}};// Handler for deleting a project\nconst handleDeleteProject=async()=>{try{await api.projects.delete(selectedProject.id);// Remove the project from the list\nsetProjects(projects.filter(project=>project.id!==selectedProject.id));// Close dialog\nsetOpenDeleteDialog(false);setSnackbar({open:true,message:'Project deleted successfully!',severity:'success'});}catch(error){var _error$response3,_error$response3$data;console.error('Error deleting project:',error);setSnackbar({open:true,message:`Failed to delete project: ${((_error$response3=error.response)===null||_error$response3===void 0?void 0:(_error$response3$data=_error$response3.data)===null||_error$response3$data===void 0?void 0:_error$response3$data.message)||error.message}`,severity:'error'});setOpenDeleteDialog(false);}};const filteredProjects=projects.filter(project=>{var _project$name,_project$description;return((_project$name=project.name)===null||_project$name===void 0?void 0:_project$name.toLowerCase().includes(search.toLowerCase()))||((_project$description=project.description)===null||_project$description===void 0?void 0:_project$description.toLowerCase().includes(search.toLowerCase()));});if(loading){return/*#__PURE__*/_jsx(Box,{sx:{display:'flex',justifyContent:'center',mt:10},children:/*#__PURE__*/_jsx(CircularProgress,{})});}return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsxs(Box,{sx:{display:'flex',justifyContent:'space-between',alignItems:'center',mb:3},children:[/*#__PURE__*/_jsx(Typography,{variant:\"h4\",component:\"h1\",children:\"Projects\"}),/*#__PURE__*/_jsx(Button,{variant:\"contained\",startIcon:/*#__PURE__*/_jsx(AddIcon,{}),onClick:()=>setOpenNewProject(true),children:\"New Project\"})]}),/*#__PURE__*/_jsxs(Paper,{sx:{mb:4,p:2},children:[/*#__PURE__*/_jsxs(Box,{sx:{display:'flex',justifyContent:'space-between',mb:2},children:[/*#__PURE__*/_jsx(TextField,{placeholder:\"Search projects...\",value:search,onChange:e=>setSearch(e.target.value),variant:\"outlined\",size:\"small\",sx:{width:'40%'},InputProps:{startAdornment:/*#__PURE__*/_jsx(InputAdornment,{position:\"start\",children:/*#__PURE__*/_jsx(SearchIcon,{})})}}),/*#__PURE__*/_jsx(Button,{startIcon:/*#__PURE__*/_jsx(FilterListIcon,{}),children:\"Filters\"})]}),/*#__PURE__*/_jsx(TableContainer,{children:/*#__PURE__*/_jsxs(Table,{children:[/*#__PURE__*/_jsx(TableHead,{children:/*#__PURE__*/_jsxs(TableRow,{children:[/*#__PURE__*/_jsx(TableCell,{children:\"Project Name\"}),/*#__PURE__*/_jsx(TableCell,{children:\"Description\"}),/*#__PURE__*/_jsx(TableCell,{children:\"Last Analysis\"}),/*#__PURE__*/_jsx(TableCell,{children:\"Dependencies\"}),/*#__PURE__*/_jsx(TableCell,{children:\"Status\"}),/*#__PURE__*/_jsx(TableCell,{align:\"right\",children:\"Actions\"})]})}),/*#__PURE__*/_jsx(TableBody,{children:filteredProjects.length>0?filteredProjects.map(project=>/*#__PURE__*/_jsxs(TableRow,{hover:true,children:[/*#__PURE__*/_jsx(TableCell,{children:/*#__PURE__*/_jsx(Typography,{variant:\"subtitle2\",component:RouterLink,to:`/projects/${project.id}`,sx:{textDecoration:'none',color:'primary.main',fontWeight:'medium'},children:project.name})}),/*#__PURE__*/_jsx(TableCell,{children:project.description||'No description'}),/*#__PURE__*/_jsx(TableCell,{children:project.lastAnalysisDate||'Never'}),/*#__PURE__*/_jsx(TableCell,{children:project.dependencyCount>0?/*#__PURE__*/_jsxs(Box,{children:[/*#__PURE__*/_jsxs(Typography,{variant:\"body2\",children:[project.dependencyCount,\" total\"]}),/*#__PURE__*/_jsxs(Typography,{variant:\"body2\",color:\"warning.main\",children:[project.outdatedCount||0,\" outdated\"]})]}):'No analysis'}),/*#__PURE__*/_jsx(TableCell,{children:/*#__PURE__*/_jsx(Chip,{label:project.status==='INACTIVE'?'Inactive':'Active',color:project.status!=='INACTIVE'?'success':'default',size:\"small\"})}),/*#__PURE__*/_jsxs(TableCell,{align:\"right\",children:[/*#__PURE__*/_jsx(Button,{variant:\"outlined\",size:\"small\",component:RouterLink,to:`/projects/${project.id}/new-analysis`,sx:{mr:1},children:\"Analyze\"}),/*#__PURE__*/_jsx(IconButton,{size:\"small\",onClick:e=>handleMenuOpen(e,project),children:/*#__PURE__*/_jsx(MoreVertIcon,{})})]})]},project.id)):/*#__PURE__*/_jsx(TableRow,{children:/*#__PURE__*/_jsx(TableCell,{colSpan:6,align:\"center\",children:\"No projects found\"})})})]})})]}),/*#__PURE__*/_jsxs(Dialog,{open:openNewProject,onClose:()=>setOpenNewProject(false),children:[/*#__PURE__*/_jsx(DialogTitle,{children:\"Create New Project\"}),/*#__PURE__*/_jsxs(DialogContent,{children:[/*#__PURE__*/_jsx(TextField,{autoFocus:true,margin:\"dense\",id:\"name\",label:\"Project Name\",type:\"text\",fullWidth:true,required:true,value:newProject.name,onChange:e=>setNewProject({...newProject,name:e.target.value})}),/*#__PURE__*/_jsx(TextField,{margin:\"dense\",id:\"description\",label:\"Description\",type:\"text\",fullWidth:true,multiline:true,rows:4,value:newProject.description,onChange:e=>setNewProject({...newProject,description:e.target.value})})]}),/*#__PURE__*/_jsxs(DialogActions,{children:[/*#__PURE__*/_jsx(Button,{onClick:()=>setOpenNewProject(false),children:\"Cancel\"}),/*#__PURE__*/_jsx(Button,{onClick:handleCreateProject,variant:\"contained\",children:\"Create\"})]})]}),/*#__PURE__*/_jsxs(Dialog,{open:openEditProject,onClose:()=>setOpenEditProject(false),children:[/*#__PURE__*/_jsx(DialogTitle,{children:\"Edit Project\"}),/*#__PURE__*/_jsxs(DialogContent,{children:[/*#__PURE__*/_jsx(TextField,{autoFocus:true,margin:\"dense\",id:\"edit-name\",label:\"Project Name\",type:\"text\",fullWidth:true,required:true,value:editProjectData.name,onChange:e=>setEditProjectData({...editProjectData,name:e.target.value})}),/*#__PURE__*/_jsx(TextField,{margin:\"dense\",id:\"edit-description\",label:\"Description\",type:\"text\",fullWidth:true,multiline:true,rows:4,value:editProjectData.description,onChange:e=>setEditProjectData({...editProjectData,description:e.target.value})})]}),/*#__PURE__*/_jsxs(DialogActions,{children:[/*#__PURE__*/_jsx(Button,{onClick:()=>setOpenEditProject(false),children:\"Cancel\"}),/*#__PURE__*/_jsx(Button,{onClick:handleUpdateProject,variant:\"contained\",children:\"Save\"})]})]}),/*#__PURE__*/_jsxs(Dialog,{open:openDeleteDialog,onClose:()=>setOpenDeleteDialog(false),children:[/*#__PURE__*/_jsx(DialogTitle,{children:\"Delete Project\"}),/*#__PURE__*/_jsx(DialogContent,{children:/*#__PURE__*/_jsxs(Typography,{children:[\"Are you sure you want to delete \\\"\",selectedProject===null||selectedProject===void 0?void 0:selectedProject.name,\"\\\"? This action cannot be undone.\"]})}),/*#__PURE__*/_jsxs(DialogActions,{children:[/*#__PURE__*/_jsx(Button,{onClick:()=>setOpenDeleteDialog(false),children:\"Cancel\"}),/*#__PURE__*/_jsx(Button,{onClick:handleDeleteProject,variant:\"contained\",color:\"error\",children:\"Delete\"})]})]}),/*#__PURE__*/_jsxs(Menu,{anchorEl:menuAnchorEl,open:Boolean(menuAnchorEl),onClose:handleMenuClose,children:[/*#__PURE__*/_jsxs(MenuItem,{onClick:handleEditClick,children:[/*#__PURE__*/_jsx(ListItemIcon,{children:/*#__PURE__*/_jsx(EditIcon,{fontSize:\"small\"})}),/*#__PURE__*/_jsx(ListItemText,{primary:\"Edit\"})]}),/*#__PURE__*/_jsxs(MenuItem,{onClick:handleDeleteClick,children:[/*#__PURE__*/_jsx(ListItemIcon,{children:/*#__PURE__*/_jsx(DeleteIcon,{fontSize:\"small\"})}),/*#__PURE__*/_jsx(ListItemText,{primary:\"Delete\"})]})]}),/*#__PURE__*/_jsx(Snackbar,{open:snackbar.open,autoHideDuration:6000,onClose:closeSnackbar,anchorOrigin:{vertical:'bottom',horizontal:'right'},children:/*#__PURE__*/_jsx(Alert,{onClose:closeSnackbar,severity:snackbar.severity,sx:{width:'100%'},children:snackbar.message})})]});};export default Projects;","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}