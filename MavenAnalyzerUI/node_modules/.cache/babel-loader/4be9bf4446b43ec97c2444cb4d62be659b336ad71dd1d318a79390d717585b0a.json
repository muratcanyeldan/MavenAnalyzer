{"ast":null,"code":"import React,{useState,useEffect}from'react';import{Typography,Paper,Box,Grid,Card,CardContent,Divider,CircularProgress,Button,Table,TableBody,TableCell,TableContainer,TableHead,TableRow,Chip,TextField,InputAdornment,Select,FormControl,InputLabel,MenuItem,IconButton,Pagination}from'@mui/material';import{Link as RouterLink,useParams,useNavigate}from'react-router-dom';import SearchIcon from'@mui/icons-material/Search';import FilterListIcon from'@mui/icons-material/FilterList';import VisibilityIcon from'@mui/icons-material/Visibility';import DownloadIcon from'@mui/icons-material/Download';import DeleteIcon from'@mui/icons-material/Delete';import api from'../services/api';import{jsx as _jsx,jsxs as _jsxs,Fragment as _Fragment}from\"react/jsx-runtime\";const AnalysisHistory=()=>{const navigate=useNavigate();const[loading,setLoading]=useState(true);const[analyses,setAnalyses]=useState([]);const[projects,setProjects]=useState([]);const[search,setSearch]=useState('');const[filters,setFilters]=useState({project:'all',date:'all'});const[page,setPage]=useState(1);const[rowsPerPage]=useState(10);useEffect(()=>{// Fetch analyses and projects from the API\nconst fetchData=async()=>{setLoading(true);try{// First fetch projects to get project names for displaying in the table\nconst projectsResponse=await api.projects.getAll();const projectsData=projectsResponse.data;setProjects(projectsData);// Then fetch all analyses\nconst analysesResponse=await api.dependencyAnalysis.getAll();const analysesData=analysesResponse.data;// Enrich analyses with project names\nconst enrichedAnalyses=analysesData.map(analysis=>{const project=projectsData.find(p=>p.id===analysis.projectId);return{...analysis,projectName:project?project.name:`Project ${analysis.projectId}`,id:analysis.analysisId,// Map analysisId to id for consistency\ndate:new Date(analysis.analysisDate).toLocaleString(),// Format date for display\nstatus:analysis.totalDependencies>0?'completed':'in-progress'};});setAnalyses(enrichedAnalyses);}catch(error){console.error('Error fetching data:',error);setAnalyses([]);}finally{setLoading(false);}};fetchData();},[]);const handlePageChange=(event,newPage)=>{setPage(newPage);};const handleFilterChange=event=>{setFilters({...filters,[event.target.name]:event.target.value});};// Filter analyses based on search and filters\nconst filteredAnalyses=analyses.filter(analysis=>{const matchesSearch=analysis.projectName&&analysis.projectName.toLowerCase().includes(search.toLowerCase())||analysis.id&&analysis.id.toString().includes(search);const matchesProject=filters.project==='all'||analysis.projectId&&analysis.projectId.toString()===filters.project;return matchesSearch&&matchesProject;});// Get unique project IDs for filter dropdown\nconst projectOptions=[{id:'all',name:'All Projects'},...projects.map(project=>({id:project.id.toString(),name:project.name}))];// Paginate results\nconst paginatedAnalyses=filteredAnalyses.slice((page-1)*rowsPerPage,page*rowsPerPage);if(loading){return/*#__PURE__*/_jsx(Box,{sx:{display:'flex',justifyContent:'center',mt:10},children:/*#__PURE__*/_jsx(CircularProgress,{})});}return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(Typography,{variant:\"h4\",component:\"h1\",gutterBottom:true,children:\"Analysis History\"}),/*#__PURE__*/_jsxs(Paper,{sx:{p:3,mb:4},children:[/*#__PURE__*/_jsxs(Box,{sx:{display:'flex',flexDirection:{xs:'column',md:'row'},gap:2,mb:3},children:[/*#__PURE__*/_jsx(TextField,{placeholder:\"Search analyses...\",size:\"small\",fullWidth:true,value:search,onChange:e=>setSearch(e.target.value),InputProps:{startAdornment:/*#__PURE__*/_jsx(InputAdornment,{position:\"start\",children:/*#__PURE__*/_jsx(SearchIcon,{})})},sx:{flexGrow:1}}),/*#__PURE__*/_jsx(Box,{sx:{display:'flex',gap:2,flexWrap:'wrap'},children:/*#__PURE__*/_jsxs(FormControl,{size:\"small\",sx:{minWidth:150},children:[/*#__PURE__*/_jsx(InputLabel,{id:\"project-filter-label\",children:\"Project\"}),/*#__PURE__*/_jsx(Select,{labelId:\"project-filter-label\",name:\"project\",value:filters.project,label:\"Project\",onChange:handleFilterChange,children:projectOptions.map(option=>/*#__PURE__*/_jsx(MenuItem,{value:option.id,children:option.name},option.id))})]})})]}),/*#__PURE__*/_jsx(TableContainer,{children:/*#__PURE__*/_jsxs(Table,{children:[/*#__PURE__*/_jsx(TableHead,{children:/*#__PURE__*/_jsxs(TableRow,{children:[/*#__PURE__*/_jsx(TableCell,{children:\"ID\"}),/*#__PURE__*/_jsx(TableCell,{children:\"Project\"}),/*#__PURE__*/_jsx(TableCell,{children:\"Date\"}),/*#__PURE__*/_jsx(TableCell,{children:\"Dependencies\"}),/*#__PURE__*/_jsx(TableCell,{children:\"Outdated\"}),/*#__PURE__*/_jsx(TableCell,{children:\"Up to Date\"}),/*#__PURE__*/_jsx(TableCell,{children:\"Vulnerabilities\"}),/*#__PURE__*/_jsx(TableCell,{align:\"right\",children:\"Actions\"})]})}),/*#__PURE__*/_jsx(TableBody,{children:paginatedAnalyses.length>0?paginatedAnalyses.map(analysis=>/*#__PURE__*/_jsxs(TableRow,{hover:true,children:[/*#__PURE__*/_jsx(TableCell,{children:analysis.id}),/*#__PURE__*/_jsx(TableCell,{children:/*#__PURE__*/_jsx(Typography,{variant:\"body2\",component:RouterLink,to:`/projects/${analysis.projectId}`,sx:{textDecoration:'none',color:'primary.main',fontWeight:'medium'},children:analysis.projectName})}),/*#__PURE__*/_jsx(TableCell,{children:analysis.date}),/*#__PURE__*/_jsx(TableCell,{children:analysis.totalDependencies||0}),/*#__PURE__*/_jsx(TableCell,{children:/*#__PURE__*/_jsx(Typography,{color:analysis.outdatedDependencies>0?'warning.main':'text.primary',children:analysis.outdatedDependencies||0})}),/*#__PURE__*/_jsx(TableCell,{children:analysis.upToDateDependencies||0}),/*#__PURE__*/_jsx(TableCell,{children:/*#__PURE__*/_jsx(Typography,{color:analysis.vulnerableCount>0?'error.main':'text.primary',children:analysis.vulnerableCount||0})}),/*#__PURE__*/_jsxs(TableCell,{align:\"right\",children:[/*#__PURE__*/_jsx(IconButton,{size:\"small\",component:RouterLink,to:`/analysis/${analysis.id}`,children:/*#__PURE__*/_jsx(VisibilityIcon,{fontSize:\"small\"})}),/*#__PURE__*/_jsx(IconButton,{size:\"small\",disabled:!analysis.chartPath,children:/*#__PURE__*/_jsx(DownloadIcon,{fontSize:\"small\"})}),/*#__PURE__*/_jsx(IconButton,{size:\"small\",color:\"error\",children:/*#__PURE__*/_jsx(DeleteIcon,{fontSize:\"small\"})})]})]},analysis.id)):/*#__PURE__*/_jsx(TableRow,{children:/*#__PURE__*/_jsx(TableCell,{colSpan:8,align:\"center\",children:\"No analyses found\"})})})]})}),/*#__PURE__*/_jsx(Box,{sx:{display:'flex',justifyContent:'center',mt:3},children:/*#__PURE__*/_jsx(Pagination,{count:Math.ceil(filteredAnalyses.length/rowsPerPage),page:page,onChange:handlePageChange,color:\"primary\"})})]}),/*#__PURE__*/_jsxs(Box,{sx:{mb:4},children:[/*#__PURE__*/_jsx(Typography,{variant:\"h6\",gutterBottom:true,children:\"Stats\"}),/*#__PURE__*/_jsxs(Grid,{container:true,spacing:3,children:[/*#__PURE__*/_jsx(Grid,{item:true,xs:12,sm:6,md:3,children:/*#__PURE__*/_jsx(Card,{children:/*#__PURE__*/_jsxs(CardContent,{children:[/*#__PURE__*/_jsx(Typography,{color:\"text.secondary\",gutterBottom:true,children:\"Total Analyses\"}),/*#__PURE__*/_jsx(Typography,{variant:\"h4\",children:analyses.length})]})})}),/*#__PURE__*/_jsx(Grid,{item:true,xs:12,sm:6,md:3,children:/*#__PURE__*/_jsx(Card,{children:/*#__PURE__*/_jsxs(CardContent,{children:[/*#__PURE__*/_jsx(Typography,{color:\"text.secondary\",gutterBottom:true,children:\"Total Dependencies\"}),/*#__PURE__*/_jsx(Typography,{variant:\"h4\",children:analyses.reduce((sum,a)=>sum+(a.totalDependencies||0),0)})]})})}),/*#__PURE__*/_jsx(Grid,{item:true,xs:12,sm:6,md:3,children:/*#__PURE__*/_jsx(Card,{children:/*#__PURE__*/_jsxs(CardContent,{children:[/*#__PURE__*/_jsx(Typography,{color:\"text.secondary\",gutterBottom:true,children:\"Outdated Dependencies\"}),/*#__PURE__*/_jsx(Typography,{variant:\"h4\",color:\"warning.main\",children:analyses.reduce((sum,a)=>sum+(a.outdatedDependencies||0),0)})]})})}),/*#__PURE__*/_jsx(Grid,{item:true,xs:12,sm:6,md:3,children:/*#__PURE__*/_jsx(Card,{children:/*#__PURE__*/_jsxs(CardContent,{children:[/*#__PURE__*/_jsx(Typography,{color:\"text.secondary\",gutterBottom:true,children:\"Vulnerabilities\"}),/*#__PURE__*/_jsx(Typography,{variant:\"h4\",color:\"error.main\",children:analyses.reduce((sum,a)=>sum+(a.vulnerableCount||0),0)})]})})})]})]})]});};export default AnalysisHistory;","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}